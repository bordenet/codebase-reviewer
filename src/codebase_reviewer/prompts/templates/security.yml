# Security & Safety Analysis Prompts
# Phase: Security Assessment
# Focus: Security vulnerabilities, error handling, and safety checks

prompts:
  - id: "security.1"
    title: "Security Vulnerability Assessment"
    objective: "Identify potential security vulnerabilities and unsafe practices in the codebase"
    tasks:
      - "Scan for common security vulnerabilities (SQL injection, XSS, CSRF, etc.)"
      - "Check for hardcoded credentials, API keys, or sensitive data"
      - "Review authentication and authorization mechanisms"
      - "Identify insecure cryptographic practices"
      - "Check for unsafe deserialization or eval() usage"
      - "Review file upload/download security"
      - "Assess input validation and sanitization"
      - "Check for security headers and CORS configuration"
    deliverable: |
      **Security Assessment Report**

      ## Critical Security Issues
      For each issue, provide:
      - **File/Location**: [Exact file and line number]
      - **Vulnerability Type**: [OWASP Top 10 category, e.g., A03:2021 - Injection]
      - **CWE Reference**: [e.g., CWE-89: SQL Injection]
      - **Description**: [What the vulnerability is]
      - **Impact**: [Potential consequences]
      - **Remediation**: [Specific fix needed]

      ## Medium Priority Issues
      [Same format as above]

      ## Low Priority Issues
      [Same format as above]

      ## Security Best Practices
      [Recommendations for improving security posture]

      ## Compliance Considerations
      [Any relevant compliance requirements (GDPR, HIPAA, etc.)]

      **Example Format:**
      ```
      ### Critical: SQL Injection in User Login
      - **File**: `src/auth/login.py:45`
      - **Type**: A03:2021 - Injection (OWASP Top 10)
      - **CWE**: CWE-89 (SQL Injection)
      - **Description**: User input directly concatenated into SQL query
      - **Impact**: Attacker could bypass authentication or access sensitive data
      - **Remediation**: Use parameterized queries or ORM
      ```

  - id: "security.2"
    title: "Error Handling & Resilience Verification"
    objective: "Verify error handling patterns and system resilience"
    tasks:
      - "Review error handling patterns across the codebase"
      - "Check for proper exception handling and logging"
      - "Identify areas where errors are silently swallowed"
      - "Verify graceful degradation strategies"
      - "Check for proper resource cleanup (file handles, connections, etc.)"
      - "Review retry logic and circuit breaker patterns"
      - "Assess error messages for information leakage"
      - "Verify proper handling of edge cases and boundary conditions"
    deliverable: |
      **Error Handling Analysis**

      ## Error Handling Patterns
      [Document common error handling patterns used]

      ## Issues Found
      - **Missing Error Handling**: [List areas lacking proper error handling]
      - **Silent Failures**: [List places where errors are ignored]
      - **Resource Leaks**: [List potential resource leak scenarios]

      ## Resilience Assessment
      [Evaluate system resilience and fault tolerance]

      ## Recommendations
      [Specific improvements for error handling and resilience]

  - id: "security.3"
    title: "Dependency Security Audit"
    objective: "Assess security of third-party dependencies and supply chain"
    tasks:
      - "Review all third-party dependencies for known vulnerabilities"
      - "Check dependency versions against security advisories"
      - "Identify outdated or unmaintained dependencies"
      - "Review dependency licenses for compliance"
      - "Assess dependency update strategy"
      - "Check for dependency confusion vulnerabilities"
      - "Review package lock files for integrity"
      - "Identify opportunities to reduce dependency footprint"
    deliverable: |
      **Dependency Security Report**

      ## Vulnerable Dependencies
      [List dependencies with known vulnerabilities]

      ## Outdated Dependencies
      [List dependencies that should be updated]

      ## License Issues
      [Any licensing concerns or incompatibilities]

      ## Supply Chain Risks
      [Assessment of supply chain security risks]

      ## Recommendations
      - **Immediate Actions**: [Critical updates needed]
      - **Short-term**: [Updates to plan for]
      - **Long-term**: [Strategic dependency management improvements]
