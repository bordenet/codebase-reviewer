# Comprehensive Code Review Criteria Workflow
# Based on Perplexity.ai methodology for principal-level codebase assessment

workflow:
  name: "Comprehensive Review Criteria"
  version: "1.0"
  description: "Comprehensive codebase assessment using principal engineer-level review criteria"

  settings:
    parallel_execution: false
    fail_fast: false
    cache_results: true

  sections:
    - id: "reconnaissance"
      title: "1. High-Level Reconnaissance"
      description: "Scan architecture, map dependencies, and run static analysis"
      prompts:
        # Scan architecture docs & README
        - template: "phase0.yml#0.1"

        # Map critical modules & dependencies
        - template: "phase1.yml#1.1"

        # Run static analysis/lint tools
        - custom:
            id: "static_analysis_summary"
            title: "Run static analysis/lint tools"
            objective: "Generate a summary report identifying major code quality issues, anti-patterns, and code smells"
            prompt: |
              Generate a summary report identifying major code quality issues,
              anti-patterns, and code smells from static analysis results.

              Focus on:
              - High-severity issues that impact maintainability
              - Common anti-patterns in the detected language/framework
              - Code smells that indicate deeper architectural problems
              - Patterns that violate best practices

              Deliverable: Prioritized list of quality issues with severity ratings

    - id: "hygiene"
      title: "2. Baseline Hygiene Checks"
      description: "Survey tests, review build/CI, bookmark entry points, check comments"
      prompts:
        # Survey test coverage and testability
        - template: "phase3.yml#3.1"

        # Review build, dependency, and CI configurations
        - template: "phase3.yml#3.2"

        # Bookmark entry points and critical flows
        - template: "phase1.yml#1.2"

        # Check code comments
        - custom:
            id: "comment_quality"
            title: "Check code comments"
            objective: "Detect comments that are outdated, missing, or inconsistent with code logic"
            prompt: |
              Detect comments that are outdated, missing, or inconsistent with the code logic,
              and recommend areas needing documentation improvements.

              Analyze:
              - Comments that contradict the actual code behavior
              - TODO/FIXME comments that are outdated or vague
              - Missing comments in complex or critical code sections
              - Over-commented trivial code (noise)
              - Inconsistent comment styles

              Deliverable: List of comment issues with recommendations for improvement

    - id: "safety_security"
      title: "3. Core Safety and Security"
      description: "Identify anti-patterns, verify error handling, assess security"
      prompts:
        # Identify anti-patterns & smells
        - template: "phase2.yml#2.2"

        # Verify error handling in hot paths
        - template: "security.yml#security.2"

        # Assess security of public interfaces
        - template: "security.yml#security.1"

    - id: "architecture_insights"
      title: "4. Architecture Insights"
      description: "Visualize dependencies, trace call graphs, review history, check duplication"
      prompts:
        # Visualize module and dependency graphs
        - template: "phase1.yml#1.1"

        # Trace call graphs for data/control flow
        - template: "architecture_insights.yml#arch.1"

        # Review version control history for hotspots
        - template: "architecture_insights.yml#arch.2"

        # Check for redundant or duplicated code
        - template: "phase2.yml#2.3"

    - id: "coverage_modeling"
      title: "5. Coverage & Modeling"
      description: "Audit integrations, inspect boundaries, summarize complex code, compare tests to criticality"
      prompts:
        # Audit integrations and data models
        - template: "phase1.yml#1.3"

        # Inspect boundaries: cohesion, coupling, leakage
        - template: "architecture_insights.yml#arch.4"

        # Use GenAI/code summarizers on complex regions
        - template: "phase2.yml#2.1"

        # Compare tests to code criticality
        - template: "strategy.yml#strategy.3"

    - id: "strategy"
      title: "6. Principal Engineer Strategy"
      description: "Cross-reference with design docs, establish living maps, instrument hot paths, prioritize debt, propose improvements, mentor"
      prompts:
        # Cross-reference code with design docs
        - template: "phase0.yml#0.2"

        # Establish living dependency and privilege maps
        - template: "strategy.yml#strategy.1"

        # Instrument and profile hot paths
        - template: "strategy.yml#strategy.2"

        # Prioritize and document technical debt
        - template: "strategy.yml#strategy.4"

        # Propose focused, incremental improvements
        - template: "phase4.yml#4.2"

        # Mentor and scale review practices
        - template: "strategy.yml#strategy.5"
