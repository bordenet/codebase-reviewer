# AI Agent Guidelines - codebase-reviewer

> **Generated by**: [golden-agents](https://github.com/bordenet/golden-agents) v1.4.0 (progressive)
> **Last Updated**: 2026-02-05
> **Languages**: python
> **Type**: general

Minimal core with on-demand module loading. Templates at: `$HOME/.golden-agents/templates/`
<!-- GOLDEN:self-manage:start -->
## âš ï¸ Before ANY Task
1. Load `.ai-guidance/invariants.md` â€” contains critical rules
2. After editing ANY guidance file, check: `wc -l Agents.md .ai-guidance/*.md 2>/dev/null`
   - `Agents.md` >150 lines â†’ refactor into `.ai-guidance/`
   - Any `.ai-guidance/*.md` >250 lines â†’ split into sub-directory
<!-- GOLDEN:self-manage:end -->
<!-- GOLDEN:framework:start -->

---

## Quality Gates (MANDATORY)

Before ANY commit:
1. **Lint**: `npm run lint`
2. **Build**: `npm run build`
3. **Test**: `npm test`
4. **Coverage**: Minimum 70%

**Order matters.** Lint â†’ Build â†’ Test. Never skip steps.

---

## Communication Rules

- **No flattery** - Skip "Great question!" or "Excellent point!"
- **No hype** - Avoid "revolutionary", "game-changing", "seamless"
- **Evidence-based** - Cite sources or qualify as opinion
- **Direct** - State facts without embellishment

**Banned phrases**: production-grade, world-class, leverage, utilize, incredibly, extremely, Happy to help!

---

## ğŸš¨ Progressive Module Loading

**STOP and load the relevant module BEFORE these actions:**

### Language Modules (ğŸ”´ Required)
- ğŸ”´ **BEFORE writing python code**: Read `$HOME/.golden-agents/templates/languages/python.md`

### Workflow Modules (ğŸ”´ Required)
- ğŸ”´ **BEFORE any commit, PR, push, or merge**: Read `$HOME/.golden-agents/templates/workflows/security.md`
- ğŸ”´ **WHEN tests fail OR after 2+ failed fix attempts**: Read `$HOME/.golden-agents/templates/workflows/testing.md`
- ğŸ”´ **WHEN build fails OR lint errors appear**: Read `$HOME/.golden-agents/templates/workflows/build-hygiene.md`
- ğŸŸ¡ **BEFORE deploying to any environment**: Read `$HOME/.golden-agents/templates/workflows/deployment.md`
- ğŸŸ¡ **WHEN conversation exceeds 50 exchanges**: Read `$HOME/.golden-agents/templates/workflows/context-management.md`

### Optional: Superpowers integration

If [superpowers](https://github.com/obra/superpowers) is installed, run at session start:

```bash
node ~/.codex/superpowers-augment/superpowers-augment.js bootstrap
```

<!-- GOLDEN:framework:end -->

---

## Project-Specific Rules

**Language**: Python 3.9+ | **Framework**: Flask | **Quality**: pylint, mypy, black, pytest

### Quick Reference
- **Setup**: `pip install -e .` (development mode)
- **Tests**: `pytest tests/ -v`
- **Coverage**: 50%+ required
- **Lint**: `pylint src/codebase_reviewer` (target 9.5+/10)
- **Format**: `black src/codebase_reviewer tests/`

### ğŸ”’ CRITICAL: Pre-Commit Hooks - NEVER BYPASS
**NEVER use `git commit --no-verify` or `-n`** - This repo has IP protection hooks.

### CLI Integration Testing
After ANY CLI/import changes: `pytest tests/test_cli_integration.py -v && review-codebase --help`

### Session Resumption
Read `.resumption_state.md` at session start, update it at session end.

### macOS/BSD Notes
- BSD awk does NOT support `match()` with array capture - use `grep | sed` pipelines
- Test all regex/text processing commands before committing

---

## Shell Script Standards

**CRITICAL**: This repository MUST be friction-free for adopters. If setup is painful, the repo is worthless.

### Philosophy:

We ALWAYS rely on high-quality shell scripts to:
1. **Install dependencies** (`scripts/setup-*.sh`)
2. **Run the application** (`start-web.sh`, `setup.sh`)

### Shell Script Requirements:

Every shell script MUST:

1. **Be self-contained and robust**
   - Kill abandoned sessions tying up ports
   - Set up virtual environments automatically
   - Install dependencies without user intervention
   - Handle errors gracefully with clear messages
   - Provide colored, informative output

2. **Follow our style guide**
   ```bash
   #!/usr/bin/env bash
   set -euo pipefail  # Fail fast, catch errors

   # Colors for output
   RED='\033[0;31m'
   GREEN='\033[0;32m'
   YELLOW='\033[1;33m'
   BLUE='\033[0;34m'
   NC='\033[0m' # No Color

   log_info() { echo -e "${BLUE}â„¹${NC} $*"; }
   log_success() { echo -e "${GREEN}âœ“${NC} $*"; }
   log_warning() { echo -e "${YELLOW}âš ${NC} $*"; }
   log_error() { echo -e "${RED}âœ—${NC} $*" >&2; }
   ```

3. **Handle port conflicts intelligently**
   - Check if port is in use
   - Kill stale processes (with user awareness)
   - Find alternative ports automatically
   - Use sensible defaults (avoid system ports like 5000 on macOS)

4. **Provide excellent UX**
   - Clear progress indicators
   - Helpful error messages
   - Show URLs where services are running
   - Explain what's happening at each step

5. **Be macOS-aware**
   - Use BSD-compatible commands (not GNU)
   - Handle Apple Silicon paths (`/opt/homebrew/`)
   - Avoid ports used by macOS services (5000 = AirPlay)
   - Test with `lsof` for port checking

### Example: Running the Web App

The `start-web.sh` script MUST:
1. âœ… Set up the virtual environment
2. âœ… Kill old abandoned sessions on the target port
3. âœ… Build/install the app
4. âœ… Start the server on an available port
5. âœ… Open the web browser automatically
6. âœ… Provide clear instructions for stopping

**One command to rule them all:**
```bash
./start-web.sh
```

No manual venv activation. No port conflicts. No confusion. Just works.

## Pre-Commit Hooks

This repository uses pre-commit hooks to enforce quality standards. All commits must pass:

1. **Black formatting** - Auto-formats code
2. **PyLint** - Linting checks (9.5+/10 required)
3. **Pytest** - All tests must pass (50%+ coverage required)
4. **MyPy** - Type checking

The hooks run automatically on `git commit`. If they fail, the commit is blocked.

---

## ğŸš¨ **CRITICAL: CLI Integration Testing - QUALITY GATE**

### **The Incident That Must Never Repeat**

On 2025-11-26, we had a critical quality gate failure:
- All 177 unit tests passed âœ…
- The CLI was completely broken due to import errors âŒ
- CI passed, code was pushed to main
- The tool was unusable - broken imports in `cli/enterprise.py`
- Senior stakeholders saw a broken repository

**Root Cause**: Unit tests tested individual modules but never tested whether the CLI could actually start.

### **MANDATORY: CLI Integration Tests**

The file `tests/test_cli_integration.py` exists to prevent this. It tests:

1. **All CLI module imports work** - Tests that all `cli/*.py` files can be imported
2. **CLI starts successfully** - Tests that `review-codebase --help` works
3. **All commands are accessible** - Tests that each command's `--help` works
4. **Subprocess verification** - Tests the CLI via subprocess (like a real user)

### **NEVER Do This:**

âŒ Refactor CLI imports without running `tests/test_cli_integration.py`
âŒ Add new CLI commands without adding integration tests
âŒ Assume unit tests passing means the CLI works
âŒ Push to main without verifying `review-codebase --help` works

### **ALWAYS Do This:**

âœ… Run `review-codebase --help` locally before pushing
âœ… Run `pytest tests/test_cli_integration.py -v` after any CLI changes
âœ… Add integration tests for new CLI commands
âœ… Test each CLI command's `--help` after refactoring

### **The Golden Rule:**

**If you refactor imports or module structure, the CLI integration tests MUST pass.**

```bash
# After any CLI or import changes:
pytest tests/test_cli_integration.py -v
review-codebase --help
```

This is not optional. This is a hard requirement.
